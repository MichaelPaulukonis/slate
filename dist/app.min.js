!function(e){"object"==typeof exports&&"undefined"!=typeof module||"function"!=typeof define||!define.amd?e():define(e)}(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=Backbone,c=u.Model,s=function(n){var o=function(){e(this,o),null!=n&&n.apply(this,arguments)};return t(o,n),l(o,[{key:"defaults",value:function(){return{bgColor:"#018790",textColor:"#fff",font:"Georgia, serif",text:"Generate your text here",width:540,height:540,fontHeight:50,delay:250}}}]),o}(c),f=s,h=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),d=function(e,t,n){var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:SlateConfigView__get(r,t,n)}if("value"in o)return o.value;var i=o.get;return void 0===i?void 0:i.call(n)},g=Backbone,p=g.View,v=function(e){var t=function(e){n(this,t),_.defaults(e,{events:{"change .text-color":"setTextColor","change .bg-color":"setBgColor","keyup .height":"setFontHeight","keyup .text":"setText","keyup .delay":"setDelay"}}),d(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.$(".text-color").val(this.model.get("textColor")),this.$(".bg-color").val(this.model.get("bgColor"))};return o(t,e),h(t,[{key:"initialize",value:function(){this._setDebouncedText=_.debounce(_.bind(this.setDebouncedText,this),300)}},{key:"setDebouncedText",value:function(e){this.model.set({text:e})}},{key:"setDelay",value:function(e){this.model.set({delay:parseInt($(e.target).val(),10)})}},{key:"setText",value:function(e){var t=$(e.target).val();this._setDebouncedText(t)}},{key:"setFontHeight",value:function(e){this.model.set({fontHeight:parseInt($(e.target).val(),10)})}},{key:"setTextColor",value:function(e){this.model.set({textColor:"#"+$(e.target).val()})}},{key:"setBgColor",value:function(e){this.model.set({bgColor:"#"+$(e.target).val()})}},{key:"setAttributes",value:function(e){var t=$('[name="text"]').val();this.model.set({text:t})}}]),t}(p),y=v,b={setFont:function(e){var t=this.fontHeight*this.scale+"px";e.font=t+"/"+t+" "+this.font},createDummy:function(){var e=document.createElement("canvas");return e.width=this.width*this.scale,e.height=this.height*this.scale,e.getContext("2d")},drawBackground:function(e){var t=e.canvas.width,n=e.canvas.height;e.fillStyle=this.bgColor,e.fillRect(0,0,t,n)},drawText:function(e,t){var n=e.canvas.width/2,o=e.canvas.height/2;e.textAlign="center",e.textBaseline="middle",e.fillStyle=this.textColor,e.fillText(t,n,o)},drawDummy:function(e,t){var n=e.canvas.width,o=e.canvas.height;e.drawImage(t.canvas,0,0,n,o)},getCanvas:function(e){var t=document.createElement("canvas");return t.width=this.width,t.height=this.height,t},setProperties:function(e){this.bgColor=e.bgColor,this.height=e.height,this.width=e.width,this.text=e.text||"",this.textColor=e.textColor,this.delay=e.delay||350,this.fontHeight=e.fontHeight||40,this.font=e.font||"Georgia, serif",this.scale=2},render:function(e){var t=this,n=t.getCanvas().getContext("2d"),o=t.createDummy(),r=t.getGifCreator(e);t.setFont(o);for(var i=this.text.trim().split(" "),a=0,l=i.length;l>a;a++)t.drawBackground(o),t.drawText(o,i[a]),t.drawDummy(n,o),r.addFrame(n,{copy:!0,delay:t.delay});t.drawBackground(o),t.drawDummy(n,o),r.addFrame(n,{copy:!0,delay:2*t.delay}),r.render()},getGifCreator:function(e){var t=this,n=new GIF({workers:2,quality:10,width:t.width,height:t.height});return n.on("finished",function(t,n){var o=btoa(String.fromCharCode.apply(null,n));localStorage.dataBase64=o,e.src="data:image/gif;base64,"+o;var r="Client-ID 6a5400948b3b376";console.log("uploading"),$.ajax({url:"https://api.imgur.com/3/image",type:"POST",headers:{Authorization:r,Accept:"application/json"},data:{image:localStorage.dataBase64,type:"base64"},success:function(e){var t=e.data.id;window.location="https://imgur.com/gallery/"+t,console.log("id",t)},error:function(e){console.log(e)}})}),n}},m=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),w=function(e,t,n){var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:SlateView__get(r,t,n)}if("value"in o)return o.value;var i=o.get;return void 0===i?void 0:i.call(n)},x=Backbone,C=x.View,k=function(e){var t=function(e){r(this,t),w(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.listenTo(this.model,"change",this.render)};return i(t,e),m(t,[{key:"render",value:function(){b.setProperties(this.model.toJSON()),b.render(document.getElementById("result"))}}]),t}(C),O=k,T=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),j=function(){function e(){a(this,e)}return T(e,[{key:"render",value:function(){var e=new f;new y({model:e,el:$(".slate__config")}),new O({model:e,el:$(".slate__preview")})}}]),e}();(new j).render()});
