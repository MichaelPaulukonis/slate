!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("config/share")):"function"==typeof define&&define.amd?define(["config/share"],t):t(e.config)}(this,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function r(){var e=["monospace","sans-serif","serif"],t="mmmmmmmmmmlli",n="72px",r=document.getElementsByTagName("body")[0],o=document.createElement("span");o.style.fontSize=n,o.innerHTML=t;var i={},a={};for(var l in e)o.style.fontFamily=e[l],r.appendChild(o),i[e[l]]=o.offsetWidth,a[e[l]]=o.offsetHeight,r.removeChild(o);var u=function(t){var n=!1;for(var l in e){o.style.fontFamily=t+","+e[l],r.appendChild(o);var u=o.offsetWidth!=i[e[l]]||o.offsetHeight!=a[e[l]];r.removeChild(o),n=n||u}return n};this.detect=u}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}var h=["#B7D438","#1C747F","#4B687C","#5CB932","#EF7409","#F3D063","#31B98E","#6AA398","#D55A29","#B32B54","#FBB30D","#621239","#315873","#C12E01","#671C41","#22A1FF","#621239","#6CC08E","#3B8187","#D3192F","#80A000","#F48200","#000C3B","#3B8187","#BE1E2D","#1A2728","#5F8964","#EA5F61","#BA4938","#185546","#4667B2","#74A187","#F10043","#EEA623","#3B5C79"],f=h,p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),g=Backbone,v=g.Model,y=function(e){var r=function(){t(this,r),null!=e&&e.apply(this,arguments)};return n(r,e),p(r,[{key:"defaults",value:function(){var e=f[Math.floor(Math.random()*f.length)];return console.log(e),{bgColor:e,textColor:"#fff",family:"Georgia",text:"The shortest answer is doing the thing.",note:"Ernest Hemingway",width:360,height:400,fontHeight:35,delay:300}}}]),r}(v),m=y,w=["Andale Mono","Arial Black","Arial Narrow","Arial Rounded MT Bold","Arial","Avant Garde","Baskerville","Big Caslon","Bodoni MT","Book Antiqua","Brush Script MT","Calibri","Calisto MT","Cambria","Candara","Century Gothic","Consolas","Copperplate","Courier New","Didot","Franklin Gothic Medium","Futura","Garamond","Geneva","Georgia","Gill Sans","Goudy Old Style","Helvetica","Hoefler Text","Impact","Lucida Bright","Lucida Console","Lucida Grande","Lucida Sans Typewriter","Monaco","Optima","Palatino","Papyrus","Perpetua","Rockwell Extra Bold","Rockwell","Segoe UI","Tahoma","Times New Roman","Trebuchet MS","Verdana"],b=new r,C=[];w.forEach(function(e){b.detect(e)&&C.push(e)});var x=C,k=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),O=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:SlateConfigView__get(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},B=Backbone,T=B.View,S=function(e){var t=function(e){o(this,t),_.defaults(e,{events:{"change .text-color":"_updateModel","change .bg-color":"_updateModel","keyup .text":"setText","change .family":"_updateModel","keyup .delay":"_updateModel","keyup .font-height":"_updateModel","keydown .delay":"_updateInput","keydown .font-height":"_updateInput"}}),O(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.fonts=x,this.template=_.template($("script.slate-config").html())};return i(t,e),k(t,[{key:"initialize",value:function(){this._setDebouncedText=_.debounce(_.bind(this.setDebouncedText,this),300)}},{key:"render",value:function(){this.$el.append(this.template({model:this.model.attributes})),this.postRender()}},{key:"postRender",value:function(){var e=this,t=this.$(".family"),n="";this.fonts.forEach(function(t){var r=t.name===e.model.get("family")?"selected":"";n+='<option val="'+t+'"'+r+">"+t+"</option>"}),t.append(n);var r=["bgColor","textColor"];r.forEach(function(t){e.$('[name="'+t+'"]').val(e.model.get(t))})}},{key:"setDebouncedText",value:function(e){this.model.set({text:e})}},{key:"setText",value:function(e){var t=$(e.target).val();this._setDebouncedText(t)}},{key:"_updateInput",value:function(e){if(38==e.keyCode||40==e.keyCode){var t=$(e.currentTarget),n=parseInt(t.val()),r=38==e.keyCode?1:-1,o=e.shiftKey?10:1,i=n+r*o;0>i&&(i=0),t.val(i)}}},{key:"_updateModel",value:function(e){var t=$(e.currentTarget),n=t.val(),r=void 0;r=t.attr("name"),("fontHeight"===r||"delay"===r)&&(n=parseInt(n,10)),("textColor"===r||"bgColor"===r)&&(n="#"+n),this.model.set(r,n)}},{key:"setAttributes",value:function(e){var t=$('[name="text"]').val();this.model.set({text:t})}}]),t}(T),E=S,j={setFont:function(e){var t=this.fontHeight*this.scale+"px";e.font=t+"/"+t+" "+this.family},createDummy:function(){var e=document.createElement("canvas");return e.width=this.width*this.scale,e.height=this.height*this.scale,e.getContext("2d")},drawBackground:function(e){var t=e.canvas.width,n=e.canvas.height;e.fillStyle=this.bgColor,e.fillRect(0,0,t,n)},drawText:function(e,t){var n=e.canvas.width/2,r=e.canvas.height/2;e.textAlign="center",e.textBaseline="middle",e.fillStyle=this.textColor,e.fillText(t,n,r)},drawDummy:function(e,t){var n=e.canvas.width,r=e.canvas.height;e.drawImage(t.canvas,0,0,n,r)},getCanvas:function(e){var t=document.createElement("canvas");return t.width=this.width,t.height=this.height,t},setProperties:function(e){this.bgColor=e.bgColor,this.height=e.height,this.width=e.width,this.text=e.text||"",this.textColor=e.textColor,this.delay=e.delay||0,this.fontHeight=e.fontHeight||0,this.family=e.family||"Georgia, serif",this.scale=2},renderGif:function(e){var t=this,n=t.getCanvas().getContext("2d"),r=t.createDummy(),o=t.getGifCreator(e);t.setFont(r);for(var i=this.text.split(" "),a=0,l=i.length;l>a;a++)t.drawBackground(r),t.drawText(r,i[a]),t.drawDummy(n,r),o.addFrame(n,{copy:!0,delay:t.delay});t.drawBackground(r),t.drawDummy(n,r),o.addFrame(n,{delay:2*t.delay}),o.render()},getStyles:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t+=n+":"+e[n]+";");return t},getSVG:function(e){var t={display:"table-cell",width:e.canvas.width+"px",height:e.canvas.height+"px",color:this.textColor,"font-size":this.fontHeight*this.scale+"px","font-family":this.family,"vertical-align":"middle"},n=e.canvas.width-20,r={margin:"0 auto",width:n+"px","word-wrap":"break-word"},o="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='720' height='800'><foreignObject width='100%' height='100%'><div xmlns='http://www.w3.org/1999/xhtml' style='"+this.getStyles(t)+"'><div align='center' style='"+this.getStyles(r)+"'>"+this.text.trim()+"</div></div></foreignObject></svg>";return o},renderImage:function(e){var t=this,n=t.getCanvas().getContext("2d"),r=t.createDummy(),o=t.getGifCreator(e),i=(window.URL||window.webkitURL||window,new Image);i.onload=function(){t.drawBackground(r),r.drawImage(i,0,0),t.drawDummy(n,r),o.addFrame(n,{delay:0}),o.render()},i.src=this.getSVG(r)},render:function(e){this.delay>0?this.renderGif(e):this.renderImage(e)},getGifCreator:function(e){var t=this,n=new GIF({workers:2,quality:10,width:t.width,height:t.height});return n.on("finished",function(t,n){var r=btoa(String.fromCharCode.apply(null,n));e(null,r)}),n}},P=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),D=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:SlateView__get(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},A=Backbone,F=A.View,G=function(e){var t=function(e){a(this,t),D(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.listenTo(this.model,"change",this.render)};return l(t,e),P(t,[{key:"render",value:function(){j.setProperties(this.model.toJSON()),j.render(function(e,t){var n=$("#result");n.removeClass("hide"),n.attr("src","data:image/gif;base64,"+t),localStorage.dataBase64=t})}}]),t}(F),M=G,V=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),I=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:ShareView__get(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},H=Backbone,L=H.View,R=function(e){var t=function(e){u(this,t),_.defaults(e,{events:{"click .get-url":"upload"}}),I(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);var n=this;n.listenTo(n.model,"change",function(){n.model.hasChanged("url")?n.render():(n.render(),n.hideLoading(),n.model.unset("url"))}),n.template=_.template($("script.share-template").html())};return s(t,e),V(t,[{key:"postRender",value:function(){var e=this.model.get("url");e&&(this.$(".url").get(0).select(),this.$(".url-btn").addClass("hide"),this.showShare(e)),this.hideLoading()}},{key:"render",value:function(){var e=this.$(".sharer"),t={model:this.model.attributes};e.html(""),e.html(this.template(t)),this.postRender()}},{key:"showShare",value:function(e){this.$(".share-btn").hideshare({link:e,media:e+".gif",position:"right",linkedin:!1,title:this.model.get("note")||this.model.get("text")})}},{key:"showLoading",value:function(){$(".spinner").removeClass("hide"),this.$(".url-btn").addClass("hide")}},{key:"hideLoading",value:function(){$(".spinner").addClass("hide")}},{key:"upload",value:function(){this.showLoading();var e=this,t="Client-ID f0972432933fc36";$.ajax({url:"https://api.imgur.com/3/image",type:"POST",headers:{Authorization:t,Accept:"application/json"},data:{image:localStorage.dataBase64,type:"base64"},success:function(t){var n=t.data.id;e.model.set("url","http://imgur.com/"+n),console.log("image upload with this id",n)},error:function(e){console.log(e)}})}}]),t}(L),N=R,z=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),q=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:app__get(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},U=Backbone,W=U.View,J=function(e){function t(e){c(this,t),q(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);var n=new m;this.slateConfigView=new E({model:n,el:$(".slate__config")}),this.slateView=new M({model:n,el:$(".slate__preview")}),this.shareView=new N({model:n,el:$(".share-box")})}return d(t,e),z(t,[{key:"render",value:function(){this.slateConfigView.render(),this.slateView.render()}}]),t}(W);(new J).render()});
