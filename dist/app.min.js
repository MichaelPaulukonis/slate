!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("config/share")):"function"==typeof define&&define.amd?define(["config/share"],t):t(e.config)}(this,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function o(){var e=["monospace","sans-serif","serif"],t="mmmmmmmmmmlli",n="72px",o=document.getElementsByTagName("body")[0],r=document.createElement("span");r.style.fontSize=n,r.innerHTML=t;var i={},a={};for(var l in e)r.style.fontFamily=e[l],o.appendChild(r),i[e[l]]=r.offsetWidth,a[e[l]]=r.offsetHeight,o.removeChild(r);var u=function(t){var n=!1;for(var l in e){r.style.fontFamily=t+","+e[l],o.appendChild(r);var u=r.offsetWidth!=i[e[l]]||r.offsetHeight!=a[e[l]];o.removeChild(r),n=n||u}return n};this.detect=u}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}var h=["#B7D438","#1C747F","#4B687C","#5CB932","#EF7409","#F3D063","#31B98E","#6AA398","#D55A29","#B32B54","#FBB30D","#621239","#315873","#C12E01","#671C41","#22A1FF","#621239","#6CC08E"],d=h,p=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),v=Backbone,g=v.Model,y=function(e){var o=function(){t(this,o),null!=e&&e.apply(this,arguments)};return n(o,e),p(o,[{key:"defaults",value:function(){var e=d[Math.floor(Math.random()*d.length)];return console.log(e),{bgColor:e,textColor:"#fff",font:"Arial",text:"I am Awesome!",width:360,height:400,fontHeight:35,delay:250}}}]),o}(g),m=y,b=["Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Avant Garde","Calibri","Candara","Century Gothic","Franklin Gothic Medium","Futura","Geneva","Gill Sans","Helvetica","Impact","Lucida Grande","Optima","Segoe UI","Tahoma","Trebuchet MS","Verdana","Big Caslon","Bodoni MT","Book Antiqua","Calisto MT","Cambria","Didot","Garamond","Georgia","Goudy Old Style","Hoefler Text","Lucida Bright","Palatino","Perpetua","Rockwell","Rockwell Extra Bold","Baskerville","Times New Roman","Consolas","Courier New","Lucida Console","Lucida Sans Typewriter","Monaco","Andale Mono","Copperplate","Papyrus","Brush Script MT"],w=new o,C=[];b.forEach(function(e){w.detect(e)&&C.push(e)});var k=C,x=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),O=function(e,t,n){var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:SlateConfigView__get(r,t,n)}if("value"in o)return o.value;var i=o.get;return void 0===i?void 0:i.call(n)},T=Backbone,B=T.View,j=function(e){var t=function(e){r(this,t),_.defaults(e,{events:{"change .text-color":"setTextColor","change .bg-color":"setBgColor","keyup .height":"setFontHeight","keyup .text":"setText","keyup .delay":"setDelay","change .family":"setFontFamily"}}),O(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.fonts=k,this.template=_.template($("script.slate-config").html())};return i(t,e),x(t,[{key:"initialize",value:function(){this._setDebouncedText=_.debounce(_.bind(this.setDebouncedText,this),300)}},{key:"render",value:function(){this.$el.append(this.template({model:this.model.attributes})),this.postRender()}},{key:"postRender",value:function(){var e=this.$(".family");this.fonts.forEach(function(t){e.append('<option val="'+t+'">'+t+"</option>")}),this.$(".text-color").val(this.model.get("textColor")),this.$(".bg-color").val(this.model.get("bgColor"))}},{key:"setDebouncedText",value:function(e){this.model.set({text:e})}},{key:"setDelay",value:function(e){this.model.set({delay:parseInt($(e.target).val(),10)})}},{key:"setText",value:function(e){var t=$(e.target).val();this._setDebouncedText(t)}},{key:"setFontHeight",value:function(e){this.model.set({fontHeight:parseInt($(e.target).val(),10)})}},{key:"setTextColor",value:function(e){this.model.set({textColor:"#"+$(e.target).val()})}},{key:"setBgColor",value:function(e){this.model.set({bgColor:"#"+$(e.target).val()})}},{key:"setFontFamily",value:function(e){this.model.set({font:$(e.target).val().trim()})}},{key:"setAttributes",value:function(e){var t=$('[name="text"]').val();this.model.set({text:t})}}]),t}(B),S=j,P={setFont:function(e){var t=this.fontHeight*this.scale+"px";e.font=t+"/"+t+" "+this.font},createDummy:function(){var e=document.createElement("canvas");return e.width=this.width*this.scale,e.height=this.height*this.scale,e.getContext("2d")},drawBackground:function(e){var t=e.canvas.width,n=e.canvas.height;e.fillStyle=this.bgColor,e.fillRect(0,0,t,n)},drawText:function(e,t){var n=e.canvas.width/2,o=e.canvas.height/2;e.textAlign="center",e.textBaseline="middle",e.fillStyle=this.textColor,e.fillText(t,n,o)},drawDummy:function(e,t){var n=e.canvas.width,o=e.canvas.height;e.drawImage(t.canvas,0,0,n,o)},getCanvas:function(e){var t=document.createElement("canvas");return t.width=this.width,t.height=this.height,t},setProperties:function(e){this.bgColor=e.bgColor,this.height=e.height,this.width=e.width,this.text=e.text||"",this.textColor=e.textColor,this.delay=e.delay||350,this.fontHeight=e.fontHeight||40,this.font=e.font||"Georgia, serif",this.scale=2},render:function(e){var t=this,n=t.getCanvas().getContext("2d"),o=t.createDummy(),r=t.getGifCreator(e);t.setFont(o);for(var i=this.text.trim().split(" "),a=0,l=i.length;l>a;a++)t.drawBackground(o),t.drawText(o,i[a]),t.drawDummy(n,o),r.addFrame(n,{copy:!0,delay:t.delay});t.drawBackground(o),t.drawDummy(n,o),r.addFrame(n,{copy:!0,delay:2*t.delay}),r.render()},getGifCreator:function(e){var t=this,n=new GIF({workers:2,quality:10,width:t.width,height:t.height});return n.on("finished",function(t,n){var o=btoa(String.fromCharCode.apply(null,n));e(null,o)}),n}},D=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),E=function(e,t,n){var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:SlateView__get(r,t,n)}if("value"in o)return o.value;var i=o.get;return void 0===i?void 0:i.call(n)},F=Backbone,A=F.View,G=function(e){var t=function(e){a(this,t),E(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.listenTo(this.model,"change",this.render)};return l(t,e),D(t,[{key:"render",value:function(){P.setProperties(this.model.toJSON()),P.render(function(e,t){var n=$("#result");n.removeClass("hide"),n.attr("src","data:image/gif;base64,"+t),localStorage.dataBase64=t})}}]),t}(A),V=G,H=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),M=function(e,t,n){var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:ShareView__get(r,t,n)}if("value"in o)return o.value;var i=o.get;return void 0===i?void 0:i.call(n)},L=Backbone,R=L.View,I='     <a class="url-btn get-url" href="#">Get Url</a>     <% if (model.url) { %>          <input class="url" value="<%= model.url + ".gif" %>"></input>         <div class="share-btn"><i class="fa fa-share-alt"></i></div>     <% } %> ',N=function(e){var t=function(e){u(this,t),_.defaults(e,{events:{"click .get-url":"upload"}}),M(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);var n=this;n.listenTo(n.model,"change",function(){n.model.hasChanged("url")?n.render():(n.render(),n.hideLoading(),n.model.unset("url"))}),n.template=_.template(I)};return s(t,e),H(t,[{key:"postRender",value:function(){var e=this.model.get("url");e&&(this.$(".url").get(0).select(),this.$(".url-btn").addClass("hide"),this.showShare(e)),this.hideLoading()}},{key:"render",value:function(){var e=this.$(".sharer"),t={model:this.model.attributes};e.html(""),e.html(this.template(t)),this.postRender()}},{key:"showShare",value:function(e){this.$(".share-btn").hideshare({link:e,media:e+".gif",position:"right",linkedin:!1,title:this.model.get("text")})}},{key:"showLoading",value:function(){$(".spinner").removeClass("hide"),this.$(".url-btn").addClass("hide")}},{key:"hideLoading",value:function(){$(".spinner").addClass("hide")}},{key:"upload",value:function(){this.showLoading();var e=this,t="Client-ID f0972432933fc36";$.ajax({url:"https://api.imgur.com/3/image",type:"POST",headers:{Authorization:t,Accept:"application/json"},data:{image:localStorage.dataBase64,type:"base64"},success:function(t){var n=t.data.id;e.model.set("url","http://imgur.com/"+n),console.log("image upload with this id",n)},error:function(e){console.log(e)}})}}]),t}(R),q=N,z=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),U=function(e,t,n){var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:app__get(r,t,n)}if("value"in o)return o.value;var i=o.get;return void 0===i?void 0:i.call(n)},W=Backbone,J=W.View,K=function(e){function t(e){c(this,t),U(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);var n=new m;this.slateConfigView=new S({model:n,el:$(".slate__config")}),this.slateView=new V({model:n,el:$(".slate__preview")}),this.shareView=new q({model:n,el:$(".share-box")})}return f(t,e),z(t,[{key:"render",value:function(){this.slateConfigView.render(),this.slateView.render()}}]),t}(J);(new K).render()});
